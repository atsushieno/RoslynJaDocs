# .NET Compiler Platform ("Roslyn") FAQ

原文：[.NET Compiler Platform (“Roslyn”) FAQ](http://roslyn.codeplex.com/wikipage?title=FAQ)

このFAQはよくある質問や、以前のRoslyn CTPから受け継いだすばらしい質疑応答だけでなく、
学習用および初心者向けの質問なども含まれています。
チームが介入せずにコミュニティーユーザー同士で
問題が解決されているようなものもあります。
すばらしいことです！
このページ内をキーワードまたはフレーズ検索すれば、
きっと手がかりとなるものが見つかることでしょう。

<a name="faq0"></a>
**多くの質問には関連するコードスニペットがあります。
サンプルコードおよびテストコードはチームからリリースされた
[SDK Preview](http://go.microsoft.com/fwlink/?LinkId=394641)の
`%installdir%\{CSharp|VisualBasic}\APISampleUnitTests\faq.{cs|vb}`
にあります。**
コードが利用できる質問に対しては、回答文に`FAQ(27)`というようなタグが
1つ以上含まれています。
ソースコードを開いて同じ名前のタグを検索すれば
コードが見つけられるようになっています。
このドキュメントにすべてのコードが記載されているわけではないので、
そのままでは動作しないコードもあることに注意してください。
samples/testプロジェクトには常に最新のAPIに対する変更が反映されています。


## コンテンツ

* [プロジェクト/横断的な質問](#q1)
  * [Roslynにはどのようなドキュメントが用意されていますか？](#q1-1)
  * [標準的なVisual Studio 2010 SP1あるいはVisual Studio 2012とともにRoslynをSxSでインストールできますか？](#q1-2)
  * [コンパイラーパイプラインの中でソースコードを変更できますか？](#q1-3)
  * [RoslynのDLLを自分で作成したサンプルとともに配布したり、コードをブログに掲載してもいいですか？](#q1-4)
  * [製品環境下でEnd User PreviewやSDKを使用できますか？「go-live」EULAはありますか？](#q1-5)
  * [インストール後、あるいはRoslynのインストールを行わずにRoslynのEULAを確認できますか？](#q1-6)
  * [RoslynのAPIはVSのCode ModelやCodeDomとどのような関係がありますか？](#q1-7)
  * [代わりにConnectにバグを登録してもらえますか？](#q1-8)
* [情報の取得に関する質問](#q2)
  * [どうすれば明示的、あるいは('var'により)暗黙的に型が指定された変数宣言に対する型情報を取得できますか？](#q2-1)
  * [どうすれば特定のコードの位置で利用可能な、特定の型の変数すべてを取得できますか？](#q2-2)
  * [どうすれば特定のコードの位置で補完リストあるいはアクセス可能なシンボルの一覧を取得できますか？](#q2-3)
  * [どうすればアクセス可能な型のメンバーに対する補完リストを取得できますか？](#q2-4)
  * [どうすればcaller/calleeの情報を取得できますか？](#q2-5)
  * [どうすればISolutionからシンボルまたは型に対するすべての参照を検索できますか？](#q2-6)
  * [どうすれば特定の名前空間に属するメソッドの呼び出し一覧を取得できますか？](#q2-7)
  * [どうすれば1つの(あるいは参照するすべての)アセンブリに含まれるすべてのシンボルを取得できますか？](#q2-8)
  * [どうすれば式ノードの型を取得できますか？](#q2-9)
  * [どうすれば一般的なAPIを使用して引数やローカルで宣言された変数の型情報を取得できますか？](#q2-10)
  * [どうすれば特定の識別子(あるいはIdentifierNameSyntaxノード)に対応するセマンティックモデルから型情報(TypeSymbol)を取得できますか？](#q2-11)
  * [どうすれば(場合によっては添付されているトリヴィアを無視して)シンタックスノードを比較できますか？](#q2-12)
  * [コメントはどのようにしてシンタックスツリー内に格納されていますか？(また、どうやってSyntax Visualizerを使用すればよいでしょうか？)](#q2-13)
  * [構造的トリヴィアとは何ですか？またどうやって取得できますか？](#q2-14)
  * [シンタックスツリーを視覚的に操作できるような可視化機能あるいはツールはありますか？](#q2-15)
  * [どうすればシンボルに関連づけられた型が既知かどうかを判別できますか？独自にAssemblyQualifiedNameを構築することは可能ですか？](#q2-16)
  * [どうすればSymbolが同じかどうか判断できますか？](#q2-17)
  * [どうすればセマンティックモデルがシンタックスノードに関する情報を提供できるかどうか判別できますか？](#q2-18)
  * [どうすればISymbolからメタデータトークンを取得できますか？](#q2-19)
  * [(SyntaxTokenなどの)識別子はなぜNameではなくValueというプロパティを持つのでしょう？また、ValueとValueText、GetTextにはどのような関連がありますか？](#q2-20)
  * [なぜ単にChildrenではなくChildNodesAndTokensになっているのでしょうか？](#q2-21)
  * [どうすればエラーを通知するための行および列番号を取得できますか？](#q2-22)
  * [どうすれば特定のカインドを持つ構文的サブツリーをすべて取得できますか？](#q2-23)
  * [どうすれば定義された型名に対する完全修飾名を取得できますか？](#q2-24)
  * [どうすれば特定のコールサイトにバインドされたオーバーロードを特定できますか？](#q2-25)
  * [どうすれば特定の式に対するTypeSymbolに対して特定の位置にあるTypeSymbolを割り当てられるかどうか判別できますか？](#q2-26)
  * [どうすればSyntaxTree内のテキストを単にパースするのではない方法でローカル変数宣言に対する完全修飾された型名を取得できますか？](#q2-27)
  * [どうすれば.NET Frameworkのバージョンを取得できますか？](#q2-28)
  * [どうすればプロジェクト内にある各ドキュメントや項目に対して、プロジェクトのアセンブリシンボルや参照、シンタックスツリーを取得できますか？](#q2-29)
  * [どうすれば特定の(派生)型に対するアノテーションを展開できますか？](#q2-30)
  * [なぜワークスペースAPIではもっと多くのVSのコンセプト(ネストされたドキュメントや非コードファイルなど)をサポートしないのですか？](#q2-31)
  * [どうすれば継承元の型や実装されたインターフェイスを取得できますか？また、どのメンバーがオーバーライドしている、あるいは親のメンバーを実装しているか判別することはできますか？](#q2-32)
  * [どうすればシンボルを使用して、メソッドに適用された属性を検索あるいは調査できますか？](#q2-33)
* [ツリーの構築および更新に関連する質問](#q3)
  * [どうすればクラスにメソッドを追加できますか？](#q3-1)
  * [どうすれば部分的な式や宣言などを置き換えられますか?](#q3-2)
  * [どうすれば宣言サイトおよびすべての参照サイトにあるシンボルの名前を変更できますか？](#q3-3)
  * [シンタックスやシンボルに独自の情報を追加することはできますか？](#q3-4)
  * [どうすればSyntaxRewriterを使用してステートメントを削除できますか？](#q3-5)
  * [どうすれば指定された型に対するポインタ型や配列型を生成できますか？](#q3-6)
  * [どうすればSyntaxRewriterを使用して(構造的トリヴィアである)#regionおよび#endregionを削除できますか？](#q3-7)
  * [どうすれば特定のカインドのステートメントすべて(たとえば変数の中身など)をログに残せますか？](#q3-8)
  * [どうすればコードファイルからすべてのコメントを削除できますか？](#q3-9)
* [スクリプティング、REPL、コード実行に関連する質問](#q4)
  * [REPLとホスト用スクリプティングAPIに何が起きたのですか？](#q4-1)
  * [Roslyn APIとLINQの式ツリーあるいは式ツリー v2とはどのような関係がありますか？メタプログラミングとDSLの実装のどちらに適していますか？](#q4-2)
* [その他の質問](#q5)
  * [エラスティックトリヴィア(elastic trivia)とは何ですか？](#q5-1)
  * [なぜSyntaxファクトリーは問い合わせていないエラスティックトリヴィアを添付するのですか？](#q5-2)
  * [どうすればツリーあるいはノードをテキスト的な表現に整形できますか？](#q5-3)
  * [どうすればMSBuildタスクにRoslynを組み込んだ際にメタデータの取得を止めて、歳入可能性の競合を回避できますか？](#q5-4)
  * [プログラムをILにコンパイルするまでを行う一揃いの(Emit APIの)サンプルはありますか？](#q5-5)
  * [どうすればコンパイル単位から出力されたILやデバッグ情報、ドキュメントコメントをキャプチャできますか？](#q5-6)
  * [Roslynプロジェクトを使用して作成されたVS拡張を利用するにはどうすればいいですか？](#q5-7)
  * [Roslynのオブジェクトモデルのチャート図、あるいは型の継承関係ダイアグラムはありますか？](#q5-8)


### <a name="q1"></a>プロジェクト/横断的な質問
#### <a name="q1-1"></a>Roslynにはどのようなドキュメントが用意されていますか？

機能仕様書、言語機能の議論に関する設計メモがいくつかあります。
また、ドキュメントコメントはすべて揃えられています。
しかし現時点ではチームはAPIリファレンスを作成していません。
[Documentation](http://roslyn.codeplex.com/documentation)
([日本語](index.md))
を参照してください。

> 訳注：APIリファレンスは[NuDoq](http://www.nudoq.org/#!/Projects/Roslyn)
  のものが参考になるでしょう。

#### <a name="q1-2"></a>標準的なVisual Studio 2010 SP1あるいはVisual Studio 2012とともにRoslynをSxSでインストールできますか？

RoslynプレビューはVisual Studio 2013 RTMを対象としています。
したがってVisual Studio 2012を含めて、以前のバージョンのVSには
インストールできません。

#### <a name="q1-3"></a>コンパイラーパイプラインの中でソースコードを変更できますか？

開発者はコンパイラーパイプラインのそれぞれのステージにおいて
シンタックスパースや、セマンティック解析、アルゴリズム最適化、コード生成などを
行うことができるため、Roslynではプラグインアーキテクチャはサポートされていません。
しかしプレビルドのルールを使用することによって解析を行ったり、
MSBuildがcsc.exeあるいはvbc.exeにコードを渡す前に
異なるコードを生成したりすることができます。
Roslynを使用すればコードをパースしたり、コードを意味的に解析したりした後、
ツリーを書き換えたり参照を変更させたりすることができます。
そして変更結果を新しいコンパイル項目としてコンパイルすることができます。

#### <a name="q1-4"></a>RoslynのDLLを自分で作成したサンプルとともに配布したり、コードをブログに掲載してもいいですか？

サンプルコードや学習用途であればRoslynのDLLはRoslyn NuGetパッケージ
([Microsoft.CodeAnalysis](http://www.nuget.org/packages/Microsoft.CodeAnalysis))
として再配布する方法が推奨されます。

#### <a name="q1-5"></a>製品環境下でEnd User PreviewやSDKを使用できますか？「go-live」EULAはありますか？

End User CTPはプレリリースのソフトウェアです。
使用に際しての正確な使用条件やライセンス条件についてはCTPインストール時に表示される
EULAを参照してください。
既にCTPをインストール済みの場合、インストーラを再度実行すれば
使用条件が表示されるので、その後はCancelをクリックしてインストーラを終了します。

ツールのSDKのzipファイルには独自のEULAが同梱されています。
様々なRoslyn Nugetパッケージにもそれぞれ固有のEULAがあります。
これらのEULAはツールSDKをインストールした後、
Visual Studioのメインメニューにある[NuGetパッケージの管理]コマンドを実行して
「ライセンス」のリンクを開くことで確認できます。

またroslyn.codeplex.comからソースコードをダウンロードして、
Apache 2.0ライセンスの下に作業をすることもできます。

#### <a name="q1-6"></a>インストール後、あるいはRoslynのインストールを行わずにRoslynのEULAを確認できますか？

詳細については
[製品環境下でEnd User PreviewやSDKを使用できますか？「go-live」EULAはありますか？](#q1-5)
を参照してください。
ただしEULAはインストールまたは再インストール時にしか表示されないため、
EULAを確認した後はインストールをキャンセルするとよいでしょう。

#### <a name="q1-7"></a>RoslynのAPIはVSのCode ModelやCodeDomとどのような関係がありますか？

CodeDomはプログラム的なコード生成および
サーバー上におけるASP.NETのコンパイルを対象とするものです。
これは一部のツールが使用できるように後から追加されたもので、
既存のコードをモデル化してコード生成の機能を実現するためのものです。

VSのCode ModelはISV
(訳注：independent software vendor：パッケージソフトウェア開発・販売会社)
がコードをパースせずともコード指向のVS拡張を公開できるようにするためのものです。
VSのCode Modelはコードから型、メンバー、引数に至るまでを表現するものでした
(また、貧弱ながらコード生成機能もサポートしていました)。

Roslyn APIはC#およびVBのコードを完全にモデル化し、
完全なコード生成およびコード変更機能を有しています。
最終的にはVSのCode ModelをRoslyn APIで再実装することになるでしょう。
CodeDomはC#やVBチームとは別に開発されたテクノロジーなので、
(たとえ新しいRoslyn APIで書き換えたいと思う人がいたとしても)
変更する必要はありません

#### <a name="q1-8"></a>代わりにConnectにバグを登録してもらえますか？

Microsoft Open Techのメンバーたちはフォーラムやメールを通じて
様々な話し合いを行っているわけなので、皆さんの手間を減らすためにも
内部のバグであれば喜んで登録処理をします。
我々がバグを登録するといった場合には、バグ登録を行って、
顧客案件と同じ重要度が割り当てられることを保証します。
もしも皆さんがバグを追跡して、バグに対する変更を随時受け取りたいのであれば、
我々はConnectにバグ登録を行うことになります。

いくつかの理由により、我々が代わりにバグ登録を行うのでは無く、
皆さんがConnectへのバグ登録を行うようリクエストすることがあります。
1つめの理由としては、
我々の機能が原因で顧客を憤慨させるようなことは避けたいわけなので、
バグ報告者に対してバグが顧客から報告されない場合についてConnectのバグレビュー中に
問い合わせることがあるからです。
また、Connectのバグは常に顧客からの報告を受け付けられるようになっているため、
バグの再現手順や再現する環境についての問い合わせを行うことがある
というのが2つめの理由です。

Open Techのメンバーが代わりにConnectへバグ報告した場合、
Connectに対する更新情報は顧客ではなくメンバーに対してメールで通知されます。
これにより、バグを報告したメンバーから別のチームに対して、
バグと思われる問題が受け渡されます。
顧客情報や連絡先などは消去されることがあります。
これは厳密なポリシーではありません。
また、顧客と長期的なパートナー関係にある場合には
顧客の代わりにConnectへバグ報告することがあるということを意味しています。
ただしこれは我々の一般的なワークフローではありません。

我々としては顧客がフィードバックを送信したり
フィードバックをログに残したりする手順を極々簡単にしたいと考えていますので、
我々がなるべくバグ登録を行うようにするつもりです。
しかし皆さんが更新メールを受信してバグを追跡したい場合には
Connectへバグ報告をお願いすることがあります。
Connectへ報告する場合は
[VS Feedback](http://visualstudiogallery.msdn.microsoft.com/f8a5aac8-0418-4f88-9d34-bdbe2c4cfe72)
ツールを使用する方法が比較的簡単です。

### <a name="q2"></a>情報の取得に関する質問
#### <a name="q2-1"></a>どうすれば明示的、あるいは('var'により)暗黙的に型が指定された変数宣言に対する型情報を取得できますか？

'var'が指定された識別子(C#)または型名が指定された識別子(VB)をモデル化する
`IdentifierNameSyntax`から型情報を取得する方法については、
サンプルコードの`FAQ(1)`タグが指定された部分を参照してください
([インストール先についてはこちらを参照](#faq0))。
'var'宣言全体(C#)またはローカル型の推論が有効な状態での'Dim'宣言(VB)をモデル化する
`VariableDeclaratorSyntax`から型情報を取得する方法については、
サンプルコードの`FAQ(2)`タグが指定された部分を参照してください

#### <a name="q2-2"></a>どうすれば特定のコードの位置で利用可能な、特定の型の変数すべてを取得できますか？
#### <a name="q2-3"></a>どうすれば特定のコードの位置で補完リストあるいはアクセス可能なシンボルの一覧を取得できますか？
#### <a name="q2-4"></a>どうすればアクセス可能な型のメンバーに対する補完リストを取得できますか？
#### <a name="q2-5"></a>どうすればcaller/calleeの情報を取得できますか？
#### <a name="q2-6"></a>どうすればISolutionからシンボルまたは型に対するすべての参照を検索できますか？
#### <a name="q2-7"></a>どうすれば特定の名前空間に属するメソッドの呼び出し一覧を取得できますか？
#### <a name="q2-8"></a>どうすれば1つの(あるいは参照するすべての)アセンブリに含まれるすべてのシンボルを取得できますか？
#### <a name="q2-9"></a>どうすれば式ノードの型を取得できますか？
#### <a name="q2-10"></a>どうすれば一般的なAPIを使用して引数やローカルで宣言された変数の型情報を取得できますか？
#### <a name="q2-11"></a>どうすれば特定の識別子(あるいはIdentifierNameSyntaxノード)に対応するセマンティックモデルから型情報(TypeSymbol)を取得できますか？
#### <a name="q2-12"></a>どうすれば(場合によっては添付されているトリヴィアを無視して)シンタックスノードを比較できますか？
#### <a name="q2-13"></a>コメントはどのようにしてシンタックスツリー内に格納されていますか？(また、どうやってSyntax Visualizerを使用すればよいでしょうか？)
#### <a name="q2-14"></a>構造的トリヴィアとは何ですか？またどうやって取得できますか？
#### <a name="q2-15"></a>シンタックスツリーを視覚的に操作できるような可視化機能あるいはツールはありますか？
#### <a name="q2-16"></a>どうすればシンボルに関連づけられた型が既知かどうかを判別できますか？独自にAssemblyQualifiedNameを構築することは可能ですか？
#### <a name="q2-17"></a>どうすればSymbolが同じかどうか判断できますか？
#### <a name="q2-18"></a>どうすればセマンティックモデルがシンタックスノードに関する情報を提供できるかどうか判別できますか？
#### <a name="q2-19"></a>どうすればISymbolからメタデータトークンを取得できますか？
#### <a name="q2-20"></a>(SyntaxTokenなどの)識別子はなぜNameではなくValueというプロパティを持つのでしょう？また、ValueとValueText、GetTextにはどのような関連がありますか？
#### <a name="q2-21"></a>なぜ単にChildrenではなくChildNodesAndTokensになっているのでしょうか？
#### <a name="q2-22"></a>どうすればエラーを通知するための行および列番号を取得できますか？
#### <a name="q2-23"></a>どうすれば特定のカインドを持つ構文的サブツリーをすべて取得できますか？
#### <a name="q2-24"></a>どうすれば定義された型名に対する完全修飾名を取得できますか？
#### <a name="q2-25"></a>どうすれば特定のコールサイトにバインドされたオーバーロードを特定できますか？
#### <a name="q2-26"></a>どうすれば特定の式に対するTypeSymbolに対して特定の位置にあるTypeSymbolを割り当てられるかどうか判別できますか？
#### <a name="q2-27"></a>どうすればSyntaxTree内のテキストを単にパースするのではない方法でローカル変数宣言に対する完全修飾された型名を取得できますか？
#### <a name="q2-28"></a>どうすれば.NET Frameworkのバージョンを取得できますか？
#### <a name="q2-29"></a>どうすればプロジェクト内にある各ドキュメントや項目に対して、プロジェクトのアセンブリシンボルや参照、シンタックスツリーを取得できますか？
#### <a name="q2-30"></a>どうすれば特定の(派生)型に対するアノテーションを展開できますか？
#### <a name="q2-31"></a>なぜワークスペースAPIではもっと多くのVSのコンセプト(ネストされたドキュメントや非コードファイルなど)をサポートしないのですか？
#### <a name="q2-32"></a>どうすれば継承元の型や実装されたインターフェイスを取得できますか？また、どのメンバーがオーバーライドしている、あるいは親のメンバーを実装しているか判別することはできますか？
#### <a name="q2-33"></a>どうすればシンボルを使用して、メソッドに適用された属性を検索あるいは調査できますか？
### <a name="q3"></a>ツリーの構築および更新に関連する質問
#### <a name="q3-1"></a>どうすればクラスにメソッドを追加できますか？
#### <a name="q3-2"></a>どうすれば部分的な式や宣言などを置き換えられますか?
#### <a name="q3-3"></a>どうすれば宣言サイトおよびすべての参照サイトにあるシンボルの名前を変更できますか？
#### <a name="q3-4"></a>シンタックスやシンボルに独自の情報を追加することはできますか？
#### <a name="q3-5"></a>どうすればSyntaxRewriterを使用してステートメントを削除できますか？
#### <a name="q3-6"></a>どうすれば指定された型に対するポインタ型や配列型を生成できますか？
#### <a name="q3-7"></a>どうすればSyntaxRewriterを使用して(構造的トリヴィアである)#regionおよび#endregionを削除できますか？
#### <a name="q3-8"></a>どうすれば特定のカインドのステートメントすべて(たとえば変数の中身など)をログに残せますか？
#### <a name="q3-9"></a>どうすればコードファイルからすべてのコメントを削除できますか？
### <a name="q4"></a>スクリプティング、REPL、コード実行に関連する質問
#### <a name="q4-1"></a>REPLとホスト用スクリプティングAPIに何が起きたのですか？
#### <a name="q4-2"></a>Roslyn APIとLINQの式ツリーあるいは式ツリー v2とはどのような関係がありますか？メタプログラミングとDSLの実装のどちらに適していますか？
### <a name="q5"></a>その他の質問
#### <a name="q5-1"></a>エラスティックトリヴィア(elastic trivia)とは何ですか？
#### <a name="q5-2"></a>なぜSyntaxファクトリーは問い合わせていないエラスティックトリヴィアを添付するのですか？
#### <a name="q5-3"></a>どうすればツリーあるいはノードをテキスト的な表現に整形できますか？
#### <a name="q5-4"></a>どうすればMSBuildタスクにRoslynを組み込んだ際にメタデータの取得を止めて、歳入可能性の競合を回避できますか？
#### <a name="q5-5"></a>プログラムをILにコンパイルするまでを行う一揃いの(Emit APIの)サンプルはありますか？
#### <a name="q5-6"></a>どうすればコンパイル単位から出力されたILやデバッグ情報、ドキュメントコメントをキャプチャできますか？
#### <a name="q5-7"></a>Roslynプロジェクトを使用して作成されたVS拡張を利用するにはどうすればいいですか？
#### <a name="q5-8"></a>Roslynのオブジェクトモデルのチャート図、あるいは型の継承関係ダイアグラムはありますか？
